import React, { useState } from "react";

// --- 数据配置区域 ---
// 你可以在这里添加、删除或修改联系人信息。
// 每个联系人包含 telegram 用户名（username），显示名（displayName）和备注（note）
const initialContacts = [
  { username: "telegram", displayName: "Telegram", note: "Official" },
  { username: "durov", displayName: "Pavel Durov", note: "Founder" },
  { username: "example1", displayName: "Alice 美", note: "Friend" },
  { username: "example2", displayName: "Bob 工程师", note: "Dev" },
  { username: "example3", displayName: "Cathy", note: "Support" },
  { username: "example4", displayName: "David", note: "PM" },
  { username: "example5", displayName: "Eve", note: "QA" },
  { username: "example6", displayName: "Frank", note: "Ops" },
  { username: "example7", displayName: "Grace", note: "UX" },
  { username: "example8", displayName: "Heidi", note: "Design" },
];

// 群组信息，同样可以添加、删除、修改
const initialGroups = [
  { username: "telegramgroup1", displayName: "Dev Group" },
  { username: "telegramgroup2", displayName: "Announce" },
  { username: "telegramgroup3", displayName: "Friends" },
];

// 软件库信息，分 PC / Android / IOS 三大类，每个类别中是若干个软件文件
const initialLibrary = {
  PC: [
    {
      title: "Tooling-v1.0.zip",
      url: "https://github.com/yourname/yourrepo/releases/download/v1.0/tooling.zip",
    },
    {
      title: "SetupGuide.pdf",
      url: "https://github.com/yourname/yourrepo/raw/main/docs/SetupGuide.pdf",
    },
  ],
  Android: [
    {
      title: "app-release.apk",
      url: "https://github.com/yourname/yourrepo/releases/download/v1.0/app-release.apk",
    },
  ],
  IOS: [
    {
      title: "iOS-Notes.txt",
      url: "https://github.com/yourname/yourrepo/raw/main/ios/notes.txt",
    },
  ],
};

// ---------------------------------------------
// 头像组件，负责显示每个联系人的头像
// 会尝试从 telegram 头像地址拉取图片，失败则显示首字母代替头像
function Avatar({ username, size = 64, alt }) {
  // telegram头像地址，用户名替换
  const src = `https://t.me/i/userpic/320/${username}.jpg`;

  // 如果头像加载失败，则显示昵称或用户名的前两个字母
  const initials = (alt || username || "?").slice(0, 2).toUpperCase();

  // React hook，用来判断头像是否加载出错
  const [errored, setErrored] = useState(false);

  // 头像加载失败时显示首字母代替头像
  if (errored || !username) {
    return (
      <div
        className="flex items-center justify-center rounded-md border bg-gray-100 text-xl font-semibold"
        style={{ width: size, height: size }}
      >
        {initials}
      </div>
    );
  }

  // 头像正常显示
  return (
    <img
      src={src}
      alt={alt || username}
      width={size}
      height={size}
      className="rounded-md object-cover border"
      onError={() => setErrored(true)} // 头像加载失败则切换到首字母显示
    />
  );
}

// 主组件
export default function TelegramLandingPage() {
  // 把配置的联系人、群组、软件库放入React状态，方便后期动态修改
  const [contacts, setContacts] = useState(initialContacts);
  const [groups, setGroups] = useState(initialGroups);
  const [library] = useState(initialLibrary);
  const [query, setQuery] = useState(""); // 搜索框输入内容

  // 点击联系人或群组时打开对应telegram页面
  function openTelegram(username) {
    const url = `https://t.me/${username}`;
    window.open(url, "_blank", "noopener,noreferrer");
  }

  // 根据搜索内容过滤联系人或群组列表
  function filtered(list) {
    if (!query.trim()) return list; // 搜索为空则返回全部
    const q = query.toLowerCase();
    return list.filter(
      (i) =>
        (i.displayName && i.displayName.toLowerCase().includes(q)) ||
        (i.username && i.username.toLowerCase().includes(q))
    );
  }

  return (
    // 整体页面背景和布局
    <div className="min-h-screen bg-gradient-to-b from-white to-gray-50 py-12 px-6 flex flex-col">
      {/* 最大宽度容器，内容部分 */}
      <div className="max-w-6xl mx-auto flex-grow">
        {/* 页面头部，标题和搜索框 */}
        <header className="mb-8 flex items-center justify-between">
          <div>
            {/* 网站主标题，已改为 LvSickN8的后花园 */}
            <h1 className="text-3xl font-extrabold">LvSickN8的后花园</h1>
            {/* 副标题说明 */}
            <p className="text-sm text-gray-500 mt-1">
              扁平化 · 精致卡片 · 轻量部署到 GitHub Pages
            </p>
          </div>

          {/* 搜索输入框和“使用说明”链接 */}
          <div className="flex items-center gap-4">
            <input
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="搜索姓名或用户名..."
              className="rounded-md border px-3 py-2 shadow-sm w-64 text-sm"
            />
            <a
              className="text-sm underline hover:no-underline text-gray-600"
              href="#howto"
              onClick={(e) => {
                e.preventDefault();
                window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
              }}
            >
              使用说明
            </a>
          </div>
        </header>

        {/* --- 联系人板块 --- */}
        <section className="mb-10">
          {/* 板块标题 */}
          <h2 className="text-xl font-semibold mb-4">联系人</h2>

          {/* 联系人列表，响应式网格布局 */}
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {/* 遍历联系人数据渲染每个联系人卡片 */}
            {filtered(contacts).map((c) => (
              <button
                key={c.username}
                onClick={() => openTelegram(c.username)} // 点击跳转telegram用户主页
                className="group flex items-center gap-4 rounded-2xl border p-4 bg-white hover:shadow-lg transform hover:-translate-y-1 transition-all duration-150 text-left"
              >
                {/* 头像组件 */}
                <div className="w-16 h-16 flex-shrink-0">
                  <Avatar username={c.username} size={64} alt={c.displayName} />
                </div>

                {/* 文字信息部分 */}
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <div>
                      {/* 显示昵称 */}
                      <div className="font-medium text-gray-900">{c.displayName}</div>
                      {/* 显示 telegram 用户名 */}
                      <div className="text-xs text-gray-500">@{c.username}</div>
                    </div>

                    {/* 鼠标悬停时显示“打开” */}
                    <div className="text-xs text-gray-400 group-hover:text-blue-600">打开</div>
                  </div>

                  {/* 备注信息 */}
                  {c.note && <div className="mt-2 text-sm text-gray-500">{c.note}</div>}
                </div>
              </button>
            ))}
          </div>
        </section>

        {/* --- 群组板块 --- */}
        <section className="mb-10">
          {/* 板块标题 */}
          <h2 className="text-xl font-semibold mb-4">群组</h2>

          {/* 群组列表，响应式网格 */}
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            {filtered(groups).map((g) => (
              <a
                key={g.username}
                href={`https://t.me/${g.username}`} // 群组点击跳转链接
                target="_blank"
                rel="noopener noreferrer"
                className="group flex items-center gap-3 rounded-xl border p-3 bg-white hover:shadow-md transition-all"
              >
                {/* 群组头像 */}
                <div className="w-12 h-12 flex-shrink-0">
                  <Avatar username={g.username} size={48} alt={g.displayName} />
                </div>

                {/* 群组文字 */}
                <div className="flex-1">
                  <div className="font-medium">{g.displayName}</div>
                  <div className="text-xs text-gray-400">@{g.username}</div>
                </div>

                {/* 鼠标悬停显示加入 */}
                <div className="text-sm text-gray-400 group-hover:text-blue-600">加入</div>
              </a>
            ))}
          </div>
        </section>

        {/* --- 软件库板块 --- */}
        <section className="mb-16">
          {/* 板块标题 */}
          <h2 className="text-xl font-semibold mb-4">软件库</h2>

          {/* 软件类别分三列 */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {/* 遍历三个分类（PC, Android, IOS） */}
            {Object.entries(library).map(([category, items]) => (
              <div key={category} className="rounded-2xl border bg-white p-4">
                {/* 类别标题和数量 */}
                <div className="flex items-center justify-between mb-3">
                  <div>
                    <div className="text-lg font-semibold">{category}</div>
                    <div className="text-xs text-gray-400">{items.length} 项</div>
                  </div>
                </div>

                {/* 类别下的文件列表 */}
                <div className="space-y-3">
                  {items.map((it, idx) => (
                    <a
                      key={idx}
                      href={it.url} // 点击下载链接
                      target="_blank"
                      rel="noopener noreferrer"
                      className="flex items-center gap-3 rounded-xl border p-3 hover:shadow-sm transition-all"
                    >
                      {/* 左侧类别首字母图标 */}
                      <div className="w-12 h-12 flex-shrink-0 rounded-md bg-gray-50 flex items-center justify-center font-medium text-xs">
                        {category[0]}
                      </div>

                      {/* 文件标题和链接 */}
                      <div className="flex-1 text-left">
                        <div className="font-medium">{it.title}</div>
                        <div className="text-xs text-gray-400 truncate">{it.url}</div>
                      </div>

                      {/* 右侧下载提示 */}
                      <div className="text-sm text-gray-500">下载</div>
                    </a>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </section>
      </div>

      {/* 页脚版权信息 */}
      <footer className="border-t pt-4 text-center text-gray-500 text-sm select-none">
        © LvSickN8
      </footer>
    </div>
  );
}